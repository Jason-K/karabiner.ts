(function(n,K){typeof exports=="object"&&typeof module<"u"?K(exports):typeof define=="function"&&define.amd?define(["exports"],K):(n=typeof globalThis<"u"?globalThis:n||self,K((n.karabiner=n.karabiner||{},n.karabiner.ts={})))})(this,function(n){"use strict";let K=["left_control","left_shift","left_option","left_command","right_control","right_shift","right_option","right_command","fn"],_e=[...K,"caps_lock"],ce=["return_or_enter","escape","delete_or_backspace","delete_forward","tab","spacebar","hyphen","equal_sign","open_bracket","close_bracket","backslash","non_us_pound","semicolon","quote","grave_accent_and_tilde","comma","period","slash","non_us_backslash"],he=["up_arrow","down_arrow","left_arrow","right_arrow","page_up","page_down","home","end"],pe=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ye=["1","2","3","4","5","6","7","8","9","0"],me=["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20"],be=["keypad_num_lock","keypad_slash","keypad_asterisk","keypad_hyphen","keypad_plus","keypad_enter","keypad_1","keypad_2","keypad_3","keypad_4","keypad_5","keypad_6","keypad_7","keypad_8","keypad_9","keypad_0","keypad_period","keypad_equal_sign","keypad_comma"],ge=["print_screen","scroll_lock","pause","insert","application","help","power"],ke=["international1","international3","lang1","lang2"],we=["japanese_eisuu","japanese_kana"],ve=["volume_down","volume_up","mute","volume_decrement","volume_increment"],F=["f21","f22","f23","f24","execute","menu","select","stop","again","undo","cut","copy","paste","find","international2","international4","international5","international6","international7","international8","international9","lang3","lang4","lang5","lang6","lang7","lang8","lang9","japanese_pc_nfer","japanese_pc_xfer","japanese_pc_katakana","keypad_equal_sign_as400","locking_caps_lock","locking_num_lock","locking_scroll_lock","alternate_erase","sys_req_or_attention","cancel","clear","prior","return","separator","out","oper","clear_or_again","cr_sel_or_props","ex_sel"],j=["vk_none","vk_consumer_brightness_down","vk_consumer_brightness_up","vk_mission_control","vk_launchpad","vk_dashboard","vk_consumer_illumination_down","vk_consumer_illumination_up","vk_consumer_previous","vk_consumer_play","vk_consumer_next","display_brightness_decrement","display_brightness_increment","rewind","play_or_pause","fastforward","apple_display_brightness_decrement","apple_display_brightness_increment","dashboard","launchpad","mission_control","apple_top_case_display_brightness_decrement","apple_top_case_display_brightness_increment","illumination_decrement","illumination_increment"],rt=["rewind","play_or_pause","fast_forward","mute","volume_decrement","volume_increment","al_terminal_lock_or_screensaver","eject","scan_previous_track","scan_next_track","al_word_processor","al_text_editor","al_spreadsheet","al_presentation_app","al_email_reader","al_calculator","al_local_machine_browser","al_internet_browser","al_dictionary","fastforward"],at=["menu","al_graphics_editor","al_database_app","al_newsreader","al_voicemail","al_contacts_or_address_book","al_Calendar_Or_Schedule","al_task_or_project_manager","al_log_or_journal_or_timecard","al_checkbook_or_finance","al_a_or_v_capture_or_playback","al_lan_or_wan_browser","al_remote_networking_or_isp_connect","al_network_conference","al_network_chat","al_telephony_or_dialer","al_logon","al_logoff","al_logon_or_logoff","al_control_panel","al_command_line_processor_or_run","al_process_or_task_manager","al_select_task_or_application","al_next_task_or_application","al_previous_task_or_application","al_preemptive_halt_task_or_application","al_integrated_help_center","al_documents","al_thesaurus","al_desktop","al_spell_check","al_grammer_check","al_wireless_status","al_keyboard_layout","al_virus_protection","al_encryption","al_screen_saver","al_alarms","al_clock","al_file_browser","al_power_status","al_image_browser","al_audio_browser","al_movie_browser","al_digital_rights_manager","al_digital_wallet","al_instant_messaging","al_oem_feature_browser","al_oem_help","al_online_community","al_entertainment_content_browser","al_online_shopping_browswer","al_smart_card_information_or_help","al_market_monitor_or_finance_browser","al_customized_corporate_news_browser","al_online_activity_browswer","al_research_or_search_browswer","al_audio_player","al_message_status","al_contact_sync","al_navigation","al_contextaware_desktop_assistant","ac_home","ac_back","ac_forward","ac_refresh","ac_bookmarks","menu_pick","menu_up","menu_down","menu_left","menu_right","menu_escape","menu_value_increase","menu_value_decrease","data_on_screen","closed_caption","closed_caption_select","vcr_or_tv","broadcast_mode","snapshot","still","picture_in_picture_toggle","picture_in_picture_swap","red_menu_button","green_menu_button","blue_menu_button","yellow_menu_button","aspect","three_dimensional_mode_select"],st=["display_brightness_decrement","display_brightness_increment","dictation"],lt=["button1","button2","button3","button4","button5","button6","button7","button8","button9","button10","button11","button12","button13","button14","button15","button16","button17","button18","button19","button20","button21","button22","button23","button24","button25","button26","button27","button28","button29","button30","button31","button32"],L={"⌘":"command","⌥":"option","⌃":"control","⇧":"shift","⇪":"caps_lock"},oe={"↑":"up_arrow","↓":"down_arrow","←":"left_arrow","→":"right_arrow","⇞":"page_up","⇟":"page_down","↖︎":"home","↘︎":"end"},ne={"⏎":"return_or_enter","⎋":"escape","⌫":"delete_or_backspace","⌦":"delete_forward","⇥":"tab","␣":"spacebar","-":"hyphen","=":"equal_sign","[":"open_bracket","]":"close_bracket","\\":"backslash",";":"semicolon","'":"quote","`":"grave_accent_and_tilde",",":"comma",".":"period","/":"slash"},Ce={...oe,...ne,"⇪":L["⇪"]},ut=[...K,..._e,...ce,...he,...pe,...ye,...me,...be,...ge,...ke,...we,...ve,...F,...j];function T(t,e,i){if(typeof t=="number")return`${t}`;if(t.length>1&&U(t)){let r=W(t);if((r==null?void 0:r.length)==1)return r[0];throw new Error(`Invalid key ${t}`)}if(t in Ce)return Ce[t];let o=t;if(!ut.includes(o))throw new Error(`${o} is not valid key_code`);if(e!=null&&e.includes(o))throw new Error(`Key ${t} cannot be used ${i||"here"}`);return o}let Me={Meh:["option","control","shift"],Hyper:["command","option","control","shift"],SuperHyper:["command","option","control","shift","fn"]},re={"⌘⇧":["command","shift"],"⌥⇧":["option","shift"],"⌃⇧":["control","shift"],"⌘⌥":["command","option"],"⌘⌃":["command","control"],"⌥⌃":["option","control"],"⌘⌥⌃":["command","option","control"],"⌘⌥⇧":["command","option","shift"],"⌘⌃⇧":["command","control","shift"],"⌥⌃⇧":["option","control","shift"],"⌘⌥⌃⇧":["command","option","control","shift"],...Me};function A(t){if(!t)return;if(typeof t=="string")return U(t)?W(t):t in L?[L[t]]:t in re?re[t]:[t];if(Array.isArray(t))return ft(t)?_t(t):t.map(ct);let e;"left"in t?e=B("left",t.left):"l"in t&&(e=B("left",t.l));let i;if("right"in t?i=B("right",t.right):"r"in t&&(i=B("right",t.r)),!(!(e!=null&&e.length)&&!(i!=null&&i.length)))return[...e||[],...i||[]]}let Ke=/^(left|l|<|‹)([⌘⌥⌃⇧]*)$/,Ae=/^(right|r|>|›)([⌘⌥⌃⇧]*)$/;function V(t,e){if(!(!t&&!e))return{mandatory:Ee(t),optional:Ee(e)}}function Ee(t){if(t)return t=="any"?["any"]:A(t)}let dt=new Set(["command","option","control","shift"]);function U(t){return Ke.test(t)||Ae.test(t)}function W(t){let e=t.match(Ke);if(e)return B("left",e[2]);let i=t.match(Ae);if(i)return B("right",i[2])}function ft(t){return t.some(U)}function _t(t){return t.reduce((e,i)=>[...e,...U(i)?W(i)||[]:A(i)||[]],[])}function B(t,e){var i;if(e)return(i=A(e))==null?void 0:i.map(o=>dt.has(o)?`${t}_${o}`:o)}function ct(t){return t in L?L[t]:t}function M(t){return Array.isArray(t)?t:[t]}function k(t,e=1,i){return new v({type:"variable_if",name:t,value:e,description:i})}function ht(t,e){var o,r;let i;if(Array.isArray(t))i=t.map(Q);else if(typeof t=="string"||t instanceof RegExp)i=[Q(t)];else return new v({type:"frontmost_application_if",description:e,file_paths:(o=t.file_paths)==null?void 0:o.map(Q),bundle_identifiers:(r=t.bundle_identifiers)==null?void 0:r.map(Q)});return new v({type:"frontmost_application_if",description:e,bundle_identifiers:i})}function pt(t,e){return new v({type:"device_if",identifiers:M(t),description:e})}function yt(t,e){return new v({type:"device_exists_if",identifiers:M(t),description:e})}function mt(t,e){return new v({type:"keyboard_type_if",keyboard_types:M(t),description:e})}function bt(t,e){return new v({type:"input_source_if",input_sources:M(t),description:e})}function gt(t=!0,e){return new v({type:"event_changed_if",value:t,description:e})}let kt=wt({frontmost_application_if:"frontmost_application_unless",device_if:"device_unless",device_exists_if:"device_exists_unless",keyboard_type_if:"keyboard_type_unless",input_source_if:"input_source_unless",variable_if:"variable_unless",event_changed_if:"event_changed_unless"});class v{constructor(e){this.condition=e}unless(){return new v({...this.condition,type:kt[this.condition.type]})}build(){return{...this.condition}}}function Se(t){return typeof t.build=="function"}function D(t){return Se(t)?t.build():t}function Q(t){return typeof t=="string"?t:t.toString().slice(1,-1)}function wt(t){return Object.keys(t).reduce((e,i)=>({...e,[e[i]]:i}),t)}let vt=["optionalAny","?any","??"];function Ct(t){return!t||typeof t!="string"?!1:vt.includes(t)}function Mt(t){return/^\?(left|l|<|‹|right|r|>|›)?([⌘⌥⌃⇧⇪]*)$/.test(t)}function w(t,e){if(!t)return V(t,e);if(Ct(t))return V("","any");if(typeof t=="string"){if(Mt(t))return V("",A(t.slice(1)));if(t.startsWith("?"))throw new Error(`${t} is not valid optional alias`)}return typeof t=="object"&&"optional"in t?V("",t.optional):V(t,e)}function I(t,e,i){if(typeof t=="object")return new O(t);let o=T(t,j,"for from.key_code");return new O({key_code:o,modifiers:w(e,i)})}function Kt(t,e,i){return new O({consumer_key_code:t,modifiers:w(e,i)})}function At(t,e,i){return new O({pointing_button:t,modifiers:w(e,i)})}function m(t,e,i){let o=T(t,F,"as to.key_code");return{...i,key_code:o,modifiers:e?A(e):void 0}}function Te(t){return m("left_command","⌥⌃⇧",t)}function De(t){return m("left_option","⌃⇧",t)}function Oe(t){return m("fn","⌘⌥⌃⇧",t)}function Pe(t){return m("vk_none",void 0,t)}function $e(t,e,i){return{...i,consumer_key_code:t,modifiers:e?A(e):void 0}}function je(t,e,i){return{...i,generic_desktop:t,modifiers:e?A(e):void 0}}function Le(t,e,i){return{...i,pointing_button:t,modifiers:e?A(e):void 0}}function J(t){return{shell_command:t}}function Ve(t){let e=t.match(/^"?(.*?)(.app)?"?$/);return J(`open -a "${(e==null?void 0:e[1])||t}".app`)}function Be(t){return J(`osascript -e '
set prev to the clipboard
set the clipboard to "${t}"
tell application "System Events"
  keystroke "v" using command down
  delay 0.1
end tell
set the clipboard to prev'`)}let Ie=["Tink","Submarine","Sosumi","Morse","Ping","Pop","Purr","Glass","Hero","Frog","Funk","Blow","Bottle","Basso"];function Et(t){let e=Ie.includes(t)?`/System/Library/Sounds/${t}.aiff`:t;return J(`afplay ${e}`)}function Ne(t){return{select_input_source:t}}function c(t,e=1,i,o){return{set_variable:{name:t,value:e,key_up_value:i,type:o}}}function qe(t){return{set_variable:{name:t,type:"unset"}}}function X(t,e){return{set_notification_message:{id:t,text:e}}}function N(t){return{set_notification_message:{id:t,text:""}}}function Re(t){return{mouse_key:t}}function He(t,e="toggle"){return{sticky_modifier:{[t]:e}}}function Fe(t){return{software_function:{cg_event_double_click:{button:t}}}}function Ue(t){return{software_function:{set_mouse_cursor_position:t}}}function Je(t){return{software_function:{iokit_power_management_sleep_system:{delay_milliseconds:t}}}}let q={};for(let t=0;t<=9;t++)q[t]=m(t);let St="abcdefghijklmnopqrstuvwxyz".split("");for(let t of St)q[t]=m(t),q[t.toUpperCase()]=m(t,"⇧");let Tt=[...Object.keys(oe),...Object.keys(ne)];for(let t of Tt)q[t]=m(t);let Dt={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","'":'"',"=":"+",";":":",",":"<",".":">","/":"?","-":"_","[":"{","\\":"|","]":"}","`":"~"};for(let[t,e]of Object.entries(Dt))q[e]=m(t,"⇧");function ze(t,e){return t.split("").map(i=>{let o=(e==null?void 0:e[i])||q[i];if(!o)throw new Error(`${i} is unknown. Please provide a map with { ${i}: {ToEvent} }`);return o})}class O{constructor(e){this.manipulator={type:"basic",from:e}}get from(){return this.manipulator.from}to(e,i,o){return this.addToEvent(typeof e=="object"?e:m(e,i,o)),this}toHyper(e){return this.addToEvent(Te(e)),this}toMeh(e){return this.addToEvent(De(e)),this}toSuperHyper(e){return this.addToEvent(Oe(e)),this}toNone(e){return this.addToEvent(Pe(e)),this}toConsumerKey(e,i,o){return this.addToEvent($e(e,i,o)),this}toGenericDesktop(e,i,o){return this.addToEvent(je(e,i,o)),this}toPointingButton(e,i,o){return this.addToEvent(Le(e,i,o)),this}to$(e){return this.addToEvent(J(e)),this}toApp(e){return this.addToEvent(Ve(e)),this}toPaste(e){return this.addToEvent(Be(e)),this}toInputSource(e){return this.addToEvent(Ne(e)),this}toVar(e,i=1,o,r){return this.addToEvent(c(e,i,o,r)),this}toUnsetVar(e){return this.addToEvent(qe(e)),this}toNotificationMessage(e,i){return this.addToEvent(X(e,i)),this}toRemoveNotificationMessage(e){return this.addToEvent(N(e)),this}toMouseKey(e){return this.addToEvent(Re(e)),this}toStickyModifier(e,i="toggle"){return this.addToEvent(He(e,i)),this}toCgEventDoubleClick(e){return this.addToEvent(Fe(e)),this}toMouseCursorPosition(e){return this.addToEvent(Ue(e)),this}toSleepSystem(e){return this.addToEvent(Je(e)),this}toTypeSequence(e,i){return this.addToEvent(ze(e,i)),this}toIfAlone(e,i,o){return this.pushOrCreateList(this.manipulator,"to_if_alone",typeof e=="object"?e:m(e,i,o)),this}toIfHeldDown(e,i,o){return this.pushOrCreateList(this.manipulator,"to_if_held_down",typeof e=="object"?e:m(e,i,o)),this}toAfterKeyUp(e,i,o){return this.pushOrCreateList(this.manipulator,"to_after_key_up",typeof e=="object"?e:m(e,i,o)),this}toDelayedAction(e,i){let o=this.manipulator.to_delayed_action||{to_if_invoked:[],to_if_canceled:[]};return M(e).forEach(r=>o.to_if_invoked.push(r)),M(i).forEach(r=>o.to_if_canceled.push(r)),this.manipulator.to_delayed_action=o,this}description(e){return this.manipulator.description=e,this}condition(...e){let{conditions:i=[]}=this.manipulator;return this.manipulator.conditions=[...i,...e.map(D)],this}parameters(e){return this.manipulator.parameters={...this.manipulator.parameters,...e},this}build(e){return[{...this.manipulator}]}addToEvent(e){this.pushOrCreateList(this.manipulator,"to",e)}pushOrCreateList(e,i,o){let r=e[i]||[];M(o).forEach(a=>r.push(a)),Object.assign(e,{[i]:r})}}function Ot(t){return typeof t.build=="function"}function R(t,e){return Ot(t)?t.build(e):"type"in t?[t]:Object.entries(t).reduce((o,[r,a])=>[...o,...I(r).to(a).build(e)],[])}function Pt(...t){return e=>{let i=t.map(D);function o(l){return l.type!="basic"?l:{...l,conditions:[...l.conditions||[],...i]}}let a=(Array.isArray(e)?e:R(e)).reduce((l,f)=>[...l,...R(f).map(o)],[]);return Object.assign(a,{build:()=>a})}}function $t(t){return e=>({build:()=>(Array.isArray(t)?t.map((o,r)=>[o,r]):Object.entries(t)).reduce((o,[r,a])=>[...o,...R(e(r,a))],[])})}function jt(t,e){return i=>({build:o=>{let r=w(t,e);return(Array.isArray(i)?i:R(i)).map(l=>R(l,o)).reduce((l,f)=>l.concat(f),[]).map(l=>{var u;let f=Object.keys(r).reduce((d,h)=>{var y;if(!((y=r[h])!=null&&y.length))return d;let _=new Set([...d[h]||[],...r[h]]);return d[h]=_.has("any")?["any"]:Array.from(_),d},{...(u=l.from)==null?void 0:u.modifiers});return l.from={...l.from,modifiers:f},l})}})}function Ge(t,e,i){let o=a=>T(a,j,"for from.simultaneous"),r=new Lt({simultaneous:t.map(a=>typeof a=="object"?a:{key_code:o(a)}),simultaneous_options:e});return i&&r.parameters({"basic.simultaneous_threshold_milliseconds":i}),r}class Lt extends O{constructor(e){super(e)}modifiers(e,i){return this.manipulator.from.modifiers=e||i?w(e,i):void 0,this}}let We="__support__manipulator";function Vt(t){return t.description=(t.description||"")+We,t}function ae(t){var e;return(e=t.description)==null?void 0:e.endsWith(We)}let se={"double_tap.delay_milliseconds":200};function Bt(t,e,i,o){let r=T(t,[...F,...j],"for double tap"),a=new It({key_code:r});return o?(a.delay(o),a.from.modifiers=w(e,i)):i?typeof i=="number"?(a.delay(i),a.from.modifiers=w(e)):a.from.modifiers=w(e,i):e&&(typeof e=="number"?a.delay(e):a.from.modifiers=w(e)),a}class It extends O{constructor(e){super(e),this.singleTapEvent=void 0}singleTap(e){return this.singleTapEvent=e,this}delay(e){return this.delayParam=e,this}build(e){var y,p;let i=(e==null?void 0:e.getParameters(se))??se,o=this.delayParam||i["double_tap.delay_milliseconds"],r=this.from.key_code;if(typeof this.singleTapEvent>"u"){this.singleTapEvent={key_code:r};let s=(y=this.manipulator.from.modifiers)==null?void 0:y.mandatory;s&&(this.singleTapEvent.modifiers=s.filter(b=>b!="any"))}let a=this.singleTapEvent&&"key_code"in this.singleTapEvent?K.includes(this.singleTapEvent.key_code):!1,l=["double-tap",r];this.from.modifiers&&[this.from.modifiers.mandatory,this.from.modifiers.optional].map(s=>s!=null&&s.length?s.join(","):"").forEach(s=>s&&l.push(s));let f=l.join("-"),u=k(f).build(),d=k(f).unless().build(),h=Vt({...this.manipulator,conditions:[u]}),_={...this.manipulator,to:[c(f,1),...a?[{...this.singleTapEvent,lazy:this.singleTapEvent.lazy||typeof this.singleTapEvent.lazy>"u"}]:[]],conditions:[...this.manipulator.conditions||[],d],to_delayed_action:{to_if_invoked:[...this.singleTapEvent?[this.singleTapEvent]:[],c(f,0)],to_if_canceled:[c(f,0)]}};return a&&!((p=_.to_if_held_down)!=null&&p.length)&&(_.to_if_held_down=[this.singleTapEvent]),_.parameters={"basic.to_if_held_down_threshold_milliseconds":o,"basic.to_delayed_action_delay_milliseconds":o,...this.manipulator.parameters},[h,_]}}function Nt(){return new qt}class qt{constructor(){this.manipulator={type:"mouse_motion_to_scroll"}}modifiers(e,i){return this.manipulator.from={modifiers:w(e,i)},this}condition(...e){let{conditions:i=[]}=this.manipulator;return this.manipulator.conditions=[...i,...e.map(D)],this}options(e){return this.manipulator.options={...this.manipulator.options,...e},this}build(e){return[{...this.manipulator}]}}function Rt(t,...e){return new Y(t,...e)}class Y{constructor(e,...i){this.ruleDescription=e,this.manipulatorSources=[],this.allowEmptyManipulators=!1,this.conditions=i}manipulators(e){return Array.isArray(e)?e.forEach(i=>this.manipulatorSources.push(i)):this.manipulatorSources.push(e),this}condition(...e){return e.forEach(i=>this.conditions.push(i)),this}description(e){return this.ruleDescription=e,this}build(e){let i={description:this.ruleDescription,manipulators:this.manipulatorSources.reduce((r,a)=>[...r,...R(a,e)],[])};if(!this.allowEmptyManipulators&&i.manipulators.length==0)throw new Error(`"manipulators" is empty in "${i.description}"`);if(this.conditions.length==0)return i;let o=this.conditions.map(D);return i.manipulators=i.manipulators.map(r=>r.type=="basic"&&!ae(r)?{...r,conditions:[...r.conditions||[],...o]}:{...r}),i}}function Ht(t){return typeof t.build=="function"}function Ft(t,e){return Ht(t)?t.build(e):t}let Z={escape:["escape","caps_lock"]};function Qe(t,e,i){let o=[];if(!t)return o;for(let r of Array.isArray(t)?t:[t]){let a=I(r);o.push(...a.condition(e).to(i).build())}return o}let le={"layer.delay_by_default":!1,"layer.delay_milliseconds":200},ue=[...j,...F,...K];function Xe(t,e,i=1,o=0){return new Jt(t,e,i,o)}function Ye(t,e,i,o=1,r=0){return Xe(e,i,o,r).modifiers(t)}function Ut(t,e,i=1,o=0){return Ye("Hyper",t,e,i,o)}let x="__layer",Ze="__delay";class Jt extends Y{constructor(e,i,o=1,r=0){let a=M(e).map(l=>T(l,ue,"as layer key"));i||(i=`layer-${a.join("-")}`),super(`Layer - ${i}`),this.onValue=o,this.offValue=r,this.replaceLayerKeyToIfAlone=!1,this.delayed=void 0,this.keys=a,this.varName=i,this.layerCondition=k(this.varName,this.onValue),this.condition(this.layerCondition),this.allowEmptyManipulators=!0}modifiers(e,i){return this.layerModifiers=e||i?w(e,i):void 0,this}configKey(e,i=!1){return this.layerKeyManipulator||(this.layerKeyManipulator=I("fn")),e(this.layerKeyManipulator),this.replaceLayerKeyToIfAlone=i,this}notification(e=!0){return this.layerNotification=e,this}leaderMode(e=!0){return typeof e=="boolean"?this.leaderModeOptions=e?Z:void 0:this.leaderModeOptions={...Z,...e},this}delay(e=!0){return this.delayed=e,this}build(e){var r,a,l,f;let i=super.build(e);if(this.leaderModeOptions){let u=[c(this.varName,this.offValue),c(x,0)];this.layerNotification&&u.push(N(tt(this.varName))),this.leaderModeOptions.sticky||i.manipulators.forEach(d=>d.type=="basic"&&!ae(d)&&(d.to=(d.to||[]).concat(u))),i.manipulators.push(...Qe(this.leaderModeOptions.escape,k(this.varName,this.onValue),u))}if((a=(r=this.layerModifiers)==null?void 0:r.mandatory)!=null&&a.length||(f=(l=this.layerModifiers)==null?void 0:l.optional)!=null&&f.length){let u=et(this.layerModifiers)=="optional";i.manipulators.forEach(d=>this.addModifierAnyToManipulator(d,u))}let o=this.conditions.filter(u=>u!=this.layerCondition).map(D);for(let u of this.keys)i.manipulators=[...xe(u,this.varName,this.onValue,this.offValue,this.layerModifiers,o,e,this.layerKeyManipulator,this.replaceLayerKeyToIfAlone,typeof this.layerNotification=="boolean"&&this.layerNotification?this.ruleDescription:this.layerNotification||void 0,this.leaderModeOptions,this.delayed),...i.manipulators];return i}addModifierAnyToManipulator(e,i){if(e.type=="basic"){if(e.from.modifiers){let{mandatory:o,optional:r}=e.from.modifiers;if(r!=null&&r.length||o!=null&&o.length){let a=et(e.from.modifiers);if(a=="mandatory")e.from.modifiers={mandatory:["any"]};else if(a=="optional")e.from.modifiers={optional:["any"]};else if(!i)throw new Error("Layers with modifiers cannot have modifiers on manipulators");return}}e.from.modifiers=i?{optional:["any"]}:{mandatory:["any"]}}}}function xe(t,e,i,o,r,a,l,f,u,d,h,_){var G;function y(g){var nt;if(!f)return g;let H=f.build()[0],$=M(g)[0];if(["to","to_if_alone","to_if_held_down","to_after_key_up"].forEach(S=>{var te;return(te=H[S])==null?void 0:te.forEach(ie=>$[S]=[...$[S]||[],ie])}),H.to_delayed_action){$.to_delayed_action=$.to_delayed_action||{to_if_invoked:[],to_if_canceled:[]};for(let S of["to_if_invoked","to_if_canceled"])H.to_delayed_action[S].forEach(te=>{var ie;return(ie=$.to_delayed_action)==null?void 0:ie[S].push(te)})}return u&&($.to_if_alone=(nt=$.to_if_alone)==null?void 0:nt.filter(S=>!("key_code"in S&&S.key_code==t))),g}let p=zt(_,l),s=I({key_code:t,modifiers:r}).toVar(e,p>0?Ze:i).toVar(x).condition(p>0?k(e,o):k(e,i).unless(),k(x).unless());!((G=r==null?void 0:r.mandatory)!=null&&G.length)&&!h&&s.toIfAlone({key_code:t}),h||s.toAfterKeyUp(c(e,o)).toAfterKeyUp(c(x,0));let b=k(e,Ze).build();if(p>0&&s.toIfAlone(c(e,o)).toIfHeldDown(c(e,i)).toDelayedAction([],[{key_code:t,conditions:[b]},{set_variable:{name:e,value:o},conditions:[b]}]).parameters({"basic.to_if_held_down_threshold_milliseconds":p,"basic.to_delayed_action_delay_milliseconds":p,"basic.to_if_alone_timeout_milliseconds":p}),a!=null&&a.length&&s.condition(...a),d){let g=tt(e);p>0?(s.toIfHeldDown(X(g,d)),s.toDelayedAction([],{...N(g),conditions:[b]})):s.toNotificationMessage(g,d),h||s.toAfterKeyUp(N(g))}if(!l)return y(s.build());let P=[`layer_${t}`,...r?[JSON.stringify(r)]:[],...(a||[]).map(g=>JSON.stringify(g)).sort()].join("_"),C=l.getCache(P);if(C!=null&&C.to&&C.to_after_key_up)return C.to.find(H=>"set_variable"in H&&H.set_variable.name==e)||(C.to.push(c(e,i)),C.to_after_key_up.push(c(e,o))),y(C),[];let z=s.build(l);return l.setCache(P,z[0]),y(z)}function et({mandatory:t,optional:e}){return(t==null?void 0:t.length)==1&&t[0]=="any"?"mandatory":(e==null?void 0:e.length)==1&&e[0]=="any"?"optional":null}function tt(t){return`layer-${t}`}function zt(t,e){if(typeof t=="number")return t;if(t==!1)return 0;let i=(e==null?void 0:e.getParameters(le))??le;return t||i["layer.delay_by_default"]?i["layer.delay_milliseconds"]:0}let de={"simlayer.threshold_milliseconds":200};function Gt(t,e,i,o=1,r=0){return new Wt(t,e,i,o,r)}class Wt extends Y{constructor(e,i,o,r=1,a=0){let l=M(e).map(f=>T(f,ue,"as simlayer key"));i||(i=`simlayer-${l.join("-")}`),super(`Simlayer - ${i}`),this.threshold=o,this.onValue=r,this.offValue=a,this.sharedLayerKeys=[],this.simultaneousOptions={detect_key_down_uninterruptedly:!0,key_down_order:"strict",key_up_order:"strict_inverse",key_up_when:"any"},this.layerModifiers={optional:["any"]},this.ifActivated=[],this.ifDeactivated=[],this.keys=l,this.varName=i,this.layerCondition=k(this.varName,this.onValue),this.condition(this.layerCondition)}modifiers(e,i){return this.layerModifiers=e||i?w(e,i):void 0,this}options(e){return Object.assign(this.simultaneousOptions,e),this}enableLayer(...e){return e.map(i=>T(i,ue,"as layer key")).forEach(i=>{if(this.keys.includes(i))throw new Error(`Key ${i} is already used in ${this.ruleDescription}`);if(this.sharedLayerKeys.includes(i))throw new Error(`Key ${i} is already used as shared layer key in  ${this.ruleDescription}`);this.sharedLayerKeys.push(i)}),this}toIfActivated(e){return this.ifActivated.push(e),this}toIfDeactivated(e){return this.ifDeactivated.push(e),this}build(e){let i=super.build(e),o=(e==null?void 0:e.getParameters(de))??de,r=this.threshold||o["simlayer.threshold_milliseconds"],a=this.conditions.length>1?this.conditions.filter(u=>u!=this.layerCondition).map(D):void 0,l=c(this.varName,this.onValue),f=c(this.varName,this.offValue);i.manipulators.concat().forEach(u=>{var h;if(u.type!="basic")throw new Error(`Unsupported manipulator type ${u.type} in simlayer ${this.ruleDescription}`);let d=(h=u.from)==null?void 0:h.key_code;if(!d)throw new Error(`Missing from.key_code in simlayer ${this.ruleDescription}`);this.layerModifiers&&(u.from.modifiers={...u.from.modifiers,...this.layerModifiers});for(let _ of this.keys)i.manipulators.push({type:"basic",parameters:{"basic.simultaneous_threshold_milliseconds":r},to:[l,...u.to||[],...this.ifActivated],from:{simultaneous:[{key_code:_},{key_code:d}],simultaneous_options:{...this.simultaneousOptions,to_after_key_up:[...this.simultaneousOptions.to_after_key_up||[],f,...this.ifDeactivated]},modifiers:this.layerModifiers},conditions:a})});for(let u of this.sharedLayerKeys)i.manipulators=[...xe(u,this.varName,this.onValue,this.offValue,this.layerModifiers,a,e),...i.manipulators];return i}}let fe={"duo_layer.threshold_milliseconds":200,"duo_layer.notification":!1,"duo_layer.delay_by_default":!1,"duo_layer.delay_milliseconds":200};function Qt(t,e,i,o=1,r=0){return new Xt(t,e,i,o,r)}class Xt extends Y{constructor(e,i,o,r=1,a=0){let l=`DuoLayer ${o||`${e} ${i}`}`;o||(o=`duo-layer-${e}-${i}`),super(l),this.key1=e,this.key2=i,this.onValue=r,this.offValue=a,this.simultaneousOptions={},this.ifActivated=[],this.ifDeactivated=[],this.delayed=void 0,this.varName=o,this.layerCondition=k(this.varName,this.onValue),this.condition(this.layerCondition),this.allowEmptyManipulators=!0}threshold(e){return this.simultaneousThreshold=e,this}options(e){return Object.assign(this.simultaneousOptions,e),this}notification(e=!0){return this.layerNotification=e,this}toIfActivated(e){return this.ifActivated.push(e),this}toIfDeactivated(e){return this.ifDeactivated.push(e),this}leaderMode(e=!0){return typeof e=="boolean"?this.leaderModeOptions=e?Z:void 0:this.leaderModeOptions={...Z,...e},this}delay(e=!0){return this.delayed=e,this}build(e){let i=super.build(e),o=(e==null?void 0:e.getParameters(fe))??fe,r=this.simultaneousThreshold||o["duo_layer.threshold_milliseconds"],a=this.layerNotification??o["duo_layer.notification"],l=typeof this.delayed=="number"?this.delayed:this.delayed==!1?0:this.delayed==!0||o["duo_layer.delay_by_default"]?o["duo_layer.delay_milliseconds"]:0,f=this.conditions.filter(s=>s!=this.layerCondition).map(D),u=[c(this.varName,this.onValue),...this.ifActivated],d=[c(this.varName,this.offValue),...this.ifDeactivated];if(a){let s=`duo-layer-${this.varName}`,b=typeof a=="boolean"?this.ruleDescription:a;u.push(X(s,b)),d.push(N(s))}this.leaderModeOptions&&(this.leaderModeOptions.sticky||i.manipulators.forEach(s=>s.type=="basic"&&!ae(s)&&(s.to=(s.to||[]).concat(d))),i.manipulators.push(...Qe(this.leaderModeOptions.escape,k(this.varName,this.onValue),d)));let h=this.simultaneousOptions.to_after_key_up||[];this.leaderModeOptions||h.push(...d);let _=[[this.key1,this.key2],...l>0?[[this.key2,this.key1]]:[]].map(s=>{let b=Ge(s,{...this.simultaneousOptions,...l>0?{key_down_order:"strict"}:{},to_after_key_up:h},r).modifiers("??").condition(k(this.varName,this.onValue).unless());return f.length&&b.condition(...f),l>0?b.toIfHeldDown(u).toIfAlone(s.map(P=>m(P))).parameters({"basic.to_if_held_down_threshold_milliseconds":l,"basic.to_if_alone_timeout_milliseconds":l}):b.to(u),b});if(!e)return i.manipulators=[..._.flatMap(s=>s.build()),...i.manipulators],i;let y=["duo_layer",...[this.key1,this.key2].sort(),...f.map(s=>JSON.stringify(s)).sort()].join("_"),p=e.getCache(y);if(p)p.forEach(s=>{var P,C,z,G;((P=s.to)==null?void 0:P.find(g=>"set_variable"in g&&g.set_variable.name==this.varName))||((C=s.to)==null||C.push(c(this.varName,this.onValue)),(G=(z=s.from.simultaneous_options)==null?void 0:z.to_after_key_up)==null||G.push(c(this.varName,this.offValue)))});else{let s=_.flatMap(b=>b.build(e));e.setCache(y,s),i.manipulators=[...s,...i.manipulators]}return i}}class Yt{constructor(){this.parameters={},this.cache=new Map}setParameters(e){Object.assign(this.parameters,e)}getParameters(e){let i={...e};for(let o of Object.keys(e))o in this.parameters&&this.parameters[o]!=null&&Object.assign(i,{[o]:this.parameters[o]});return i}getCache(e){return this.cache.get(e)}setCache(e,i){this.cache.set(e,i)}}let it={"basic.to_if_alone_timeout_milliseconds":1e3,"basic.to_if_held_down_threshold_milliseconds":500,"basic.to_delayed_action_delay_milliseconds":500,"basic.simultaneous_threshold_milliseconds":50,"mouse_motion_to_scroll.speed":100};function ot(t,e={}){let{"double_tap.delay_milliseconds":i,"layer.delay_by_default":o,"layer.delay_milliseconds":r,"simlayer.threshold_milliseconds":a,"duo_layer.threshold_milliseconds":l,"duo_layer.notification":f,"duo_layer.delay_by_default":u,"duo_layer.delay_milliseconds":d,...h}=e,_=new Yt;_.setParameters({"double_tap.delay_milliseconds":i}),_.setParameters({"layer.delay_by_default":o,"layer.delay_milliseconds":r}),_.setParameters({"simlayer.threshold_milliseconds":a}),_.setParameters({"duo_layer.threshold_milliseconds":l,"duo_layer.notification":f,"duo_layer.delay_by_default":u,"duo_layer.delay_milliseconds":d});let y=t.map(s=>Ft(s,_)),p={rules:y.filter(s=>s.manipulators.length),parameters:{...it,...h}};if(p.rules.length==0)throw new Error('complex_modifications "rules" is empty ');return p.rules.length<y.length&&console.warn(`Rules with empty manipulators are ignored: 
${y.filter(s=>s.manipulators.length==0).map(s=>"- "+s.description).join(`
`)}
`),p}let E={karabinerConfigDir(){return require("node:path").join(require("node:os").homedir(),".config/karabiner")},karabinerConfigFile(){return require("node:path").join(this.karabinerConfigDir(),"karabiner.json")},readKarabinerConfig(t){return require(t??this.karabinerConfigFile())},writeKarabinerConfig(t,e){return require("node:fs/promises").writeFile(e??this.karabinerConfigFile(),t)},readJson(t){return require(t)},exit(t=0){process.exit(t)}};function Zt(t,e,i={}){typeof t=="string"&&(t={name:t,dryRun:t=="--dry-run"});let{name:o,dryRun:r}=t,a=t.karabinerJsonPath??E.karabinerConfigFile(),l=r?{profiles:[{name:o,complex_modifications:{rules:[]}}]}:E.readKarabinerConfig(a),f=l==null?void 0:l.profiles.find(d=>d.name==o);f||ee(`⚠️ Profile ${o} not found in ${a}.

ℹ️ Please check the profile name in the Karabiner-Elements UI and 
    - Update the profile name at writeToProfile()
    - Create a new profile if needed
 `);try{f.complex_modifications=ot(e,i)}catch(d){ee(d)}let u=JSON.stringify(l,null,2);if(r){console.info(u);return}E.writeKarabinerConfig(u,a).catch(ee),console.log(`✓ Profile ${o} updated.`)}function ee(t){return t&&console.error(typeof t=="string"?t:t.message||t),E.exit(1)}function xt(t,e){let i=e??E.karabinerConfigFile(),o=E.readKarabinerConfig(i);o.global={...o.global,...t};let r=JSON.stringify(o,null,2);E.writeKarabinerConfig(r,i).catch(ee),console.log("✓ global updated.")}function ei(t){return{build(){let e=E.readJson(t);if(!Array.isArray(e==null?void 0:e.rules))throw new Error(`Cannot file rules in ${t}`);return{description:`Imported from ${t}`,manipulators:e.rules.reduce((i,o)=>i.concat(o.manipulators),[])}}}}function ti(t,e){return{build(){let o=E.readKarabinerConfig(e).profiles.find(r=>r.name==t);if(!o)throw new Error(`Profile ${t} not found`);return{description:`Imported from profile ${t}`,manipulators:o.complex_modifications.rules.reduce((r,a)=>r.concat(a.manipulators),[])}}}}n.BasicManipulatorBuilder=O,n.ConditionBuilder=v,n.arrowKeyAliases=oe,n.arrowKeyCodes=he,n.buildCondition=D,n.complexModifications=ot,n.controlOrSymbolKeyAliases=ne,n.controlOrSymbolKeyCodes=ce,n.defaultComplexModificationsParameters=it,n.defaultDoubleTapParameters=se,n.defaultDuoLayerParameters=fe,n.defaultLayerParameters=le,n.defaultSimlayerParameters=de,n.duoLayer=Qt,n.fromAndToConsumerKeyCodes=rt,n.fromOnlyConsumerKeyCodes=at,n.fromOnlyKeyCodes=F,n.functionKeyCodes=me,n.getKeyWithAlias=T,n.hyperLayer=Ut,n.ifApp=ht,n.ifDevice=pt,n.ifDeviceExists=yt,n.ifEventChanged=gt,n.ifInputSource=bt,n.ifKeyboardType=mt,n.ifVar=k,n.importJson=ei,n.importProfile=ti,n.internationalKeyCodes=ke,n.isConditionBuilder=Se,n.isSideMultiModifierAlias=U,n.japaneseKeyCodes=we,n.keypadKeyCodes=be,n.layer=Xe,n.letterKeyCodes=pe,n.map=I,n.mapConsumerKey=Kt,n.mapDoubleTap=Bt,n.mapPointingButton=At,n.mapSimultaneous=Ge,n.modifierKeyAliases=L,n.modifierKeyCodes=_e,n.modifierLayer=Ye,n.mouseMotionToScroll=Nt,n.multiModifierAliases=re,n.namedMultiModifierAliases=Me,n.numberKeyCodes=ye,n.otherKeyCodes=ve,n.parseFromModifierParams=V,n.parseModifierParam=A,n.parseSideMultiModifierAlias=W,n.pcKeyboardKeyCodes=ge,n.pointingButtons=lt,n.rule=Rt,n.simlayer=Gt,n.stickyModifierKeyCodes=K,n.systemSounds=Ie,n.to$=J,n.toApp=Ve,n.toCgEventDoubleClick=Fe,n.toConsumerKey=$e,n.toGenericDesktop=je,n.toHyper=Te,n.toInputSource=Ne,n.toKey=m,n.toMeh=De,n.toMouseCursorPosition=Ue,n.toMouseKey=Re,n.toNone=Pe,n.toNotificationMessage=X,n.toOnlyConsumerKeyCodes=st,n.toOnlyKeyCodes=j,n.toPaste=Be,n.toPlaySound=Et,n.toPointingButton=Le,n.toRemoveNotificationMessage=N,n.toSetVar=c,n.toSleepSystem=Je,n.toStickyModifier=He,n.toSuperHyper=Oe,n.toTypeSequence=ze,n.toUnsetVar=qe,n.withCondition=Pt,n.withMapper=$t,n.withModifier=jt,n.writeToGlobal=xt,n.writeToProfile=Zt,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
